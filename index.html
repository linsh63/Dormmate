<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dormmate - 宿舍管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="publicItems.js" defer></script>
    <script src="lifeRecords.js" defer></script>
    <script src="sceneReconstruction.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .dorm-card {
            transition: all 0.3s ease;
        }
        .dorm-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .sidebar-item {
            transition: all 0.2s ease;
        }
        .sidebar-item:hover {
            background-color: rgba(79, 70, 229, 0.1);
            border-left: 3px solid #4f46e5;
        }
        .active-item {
            background-color: rgba(79, 70, 229, 0.1);
            border-left: 3px solid #4f46e5;
            color: #4f46e5;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-900">登录/注册</h3>
                <button onclick="toggleAuthModal()" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="username">用户名</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="username" type="text" placeholder="用户名">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="password">密码</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="password" type="password" placeholder="密码">
                </div>
                <div class="flex items-center justify-between">
                    <button onclick="login()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        登录
                    </button>
                    <button onclick="register()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        注册
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Dorm Modal -->
    <div id="createDormModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-900">创建新宿舍</h3>
                <button onclick="toggleCreateDormModal()" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="dorm-name">宿舍名称</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="dorm-name" type="text" placeholder="请输入宿舍名称">
                    <p id="dorm-name-error" class="text-red-500 text-xs italic hidden">宿舍名称不能为空</p>
                </div>
                <div class="flex items-center justify-end">
                    <button onclick="toggleCreateDormModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2">
                        取消
                    </button>
                    <button onclick="createDorm()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        创建
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="hidden md:flex md:flex-shrink-0">
            <div class="flex flex-col w-64 bg-white border-r">
                <div class="h-16 flex items-center px-4 border-b">
                    <div class="flex items-center">
                        <i class="fas fa-home text-indigo-600 text-xl mr-2"></i>
                        <span class="text-xl font-bold text-gray-800">Dormmate</span>
                    </div>
                </div>
                <div class="flex flex-col flex-grow px-4 py-4 border-b">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">我的宿舍</h3>
                    <div id="dorm-list" class="space-y-1">
                        <!-- Dorms will be added here dynamically -->
                    </div>
                    <button onclick="toggleCreateDormModal()" class="mt-2 flex items-center px-2 py-2 text-sm text-indigo-600 rounded-md hover:bg-indigo-50">
                        <i class="fas fa-plus-circle mr-2"></i>
                        <span>创建新宿舍</span>
                    </button>
                    <button onclick="showJoinDormModal()" class="mt-1 flex items-center px-2 py-2 text-sm text-indigo-600 rounded-md hover:bg-indigo-50">
                        <i class="fas fa-search mr-2"></i>
                        <span>加入宿舍</span>
                    </button>
                </div>
                <div class="flex flex-col flex-grow px-4 py-4 border-b">
                    <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">个人中心</h3>
                    <button id="profileBtn" onclick="showProfile()" class="flex items-center px-2 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100 sidebar-item">
                        <i class="fas fa-user mr-2"></i>
                        <span>个人资料</span>
                    </button>
                    <button onclick="logout()" class="mt-1 flex items-center px-2 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100 sidebar-item">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        <span>退出登录</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile sidebar -->
        <div id="mobileSidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-white transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
            <div class="h-16 flex items-center px-4 border-b">
                <div class="flex items-center">
                    <i class="fas fa-home text-indigo-600 text-xl mr-2"></i>
                    <span class="text-xl font-bold text-gray-800">Dormmate</span>
                </div>
            </div>
            <div class="flex flex-col flex-grow px-4 py-4 border-b">
                <button onclick="hideMobileSidebar()" class="absolute top-4 right-4 p-1 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100">
                    <i class="fas fa-times"></i>
                </button>
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">我的宿舍</h3>
                <div id="mobile-dorm-list" class="space-y-1">
                    <!-- Dorms will be added here dynamically -->
                </div>
                <button onclick="toggleCreateDormModal(); hideMobileSidebar()" class="mt-2 flex items-center px-2 py-2 text-sm text-indigo-600 rounded-md hover:bg-indigo-50">
                    <i class="fas fa-plus-circle mr-2"></i>
                    <span>创建新宿舍</span>
                </button>
                <button onclick="showJoinDormModal(); hideMobileSidebar()" class="mt-1 flex items-center px-2 py-2 text-sm text-indigo-600 rounded-md hover:bg-indigo-50">
                    <i class="fas fa-search mr-2"></i>
                    <span>加入宿舍</span>
                </button>
            </div>
            <div class="flex flex-col flex-grow px-4 py-4 border-b">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">个人中心</h3>
                <button onclick="showProfile(); hideMobileSidebar()" class="flex items-center px-2 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100 sidebar-item">
                    <i class="fas fa-user mr-2"></i>
                    <span>个人资料</span>
                </button>
                <button onclick="logout(); hideMobileSidebar()" class="mt-1 flex items-center px-2 py-2 text-sm text-gray-700 rounded-md hover:bg-gray-100 sidebar-item">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    <span>退出登录</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Top Navigation -->
            <div class="h-16 flex items-center justify-between px-4 bg-white border-b">
                <div class="flex items-center md:hidden">
                    <button onclick="showMobileSidebar()" class="p-2 rounded-md text-gray-500 hover:bg-gray-100 focus:outline-none">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="flex items-center ml-2">
                        <i class="fas fa-home text-indigo-600 text-xl mr-2"></i>
                        <span class="text-xl font-bold text-gray-800">Dormmate</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="relative">
                        <button onclick="toggleAccountDropdown()" class="flex items-center focus:outline-none">
                            <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
                                <i class="fas fa-user text-indigo-600"></i>
                            </div>
                            <span class="ml-2 hidden md:inline" id="username-display">未登录</span>
                            <i class="fas fa-chevron-down ml-1 hidden md:inline text-gray-400"></i>
                        </button>
                        <div id="accountDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden">
                            <a id="profile-link" onclick="showProfile()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">个人资料</a>
                            <a id="logout-link" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">退出登录</a>
                            <a id="login-link" onclick="toggleAuthModal()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">登录</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 overflow-auto p-4" id="main-content">
                <div id="home-view" class="space-y-6">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">欢迎使用 Dormmate</h2>
                        <p class="text-gray-600 mb-4">Dormmate 是一个宿舍管理系统，帮助你和你的室友更好地管理宿舍生活。</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="flex items-center p-4 bg-indigo-50 rounded-lg">
                                <div class="p-3 rounded-full bg-indigo-100 mr-4">
                                    <i class="fas fa-home text-indigo-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">宿舍管理</h3>
                                    <p class="text-sm text-gray-600">创建或加入多个宿舍</p>
                                </div>
                            </div>
                            <div class="flex items-center p-4 bg-green-50 rounded-lg">
                                <div class="p-3 rounded-full bg-green-100 mr-4">
                                    <i class="fas fa-hand-holding-usd text-green-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">经费管理</h3>
                                    <p class="text-sm text-gray-600">跟踪和审批公共费用</p>
                                </div>
                            </div>
                            <!-- 新增功能图标：公物管理 -->
                            <div class="flex items-center p-4 bg-blue-50 rounded-lg">
                                <div class="p-3 rounded-full bg-blue-100 mr-4">
                                    <i class="fas fa-couch text-blue-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">公物管理</h3>
                                    <p class="text-sm text-gray-600">管理宿舍公共物品</p>
                                </div>
                            </div>
                            <!-- 新增功能图标：共享文件夹 -->
                            <div class="flex items-center p-4 bg-purple-50 rounded-lg">
                                <div class="p-3 rounded-full bg-purple-100 mr-4">
                                    <i class="fas fa-folder-open text-purple-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">共享文件夹</h3>
                                    <p class="text-sm text-gray-600">分享和管理宿舍文件</p>
                                </div>
                            </div>
                            <!-- 新增功能图标：生活记录 -->
                            <div class="flex items-center p-4 bg-yellow-50 rounded-lg">
                                <div class="p-3 rounded-full bg-yellow-100 mr-4">
                                    <i class="fas fa-book text-yellow-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">生活记录</h3>
                                    <p class="text-sm text-gray-600">记录宿舍生活点滴</p>
                                </div>
                            </div>
                            <!-- 新增功能图标：场景重建 -->
                            <div class="flex items-center p-4 bg-red-50 rounded-lg">
                                <div class="p-3 rounded-full bg-red-100 mr-4">
                                    <i class="fas fa-cube text-red-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">场景重建</h3>
                                    <p class="text-sm text-gray-600">3D可视化宿舍布局</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="my-dorms" class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">我的宿舍</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleCreateDormModal()" class="flex items-center px-3 py-1 text-sm text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
                                    <i class="fas fa-plus mr-1"></i>
                                    <span>创建</span>
                                </button>
                                <button onclick="showJoinDormModal()" class="flex items-center px-3 py-1 text-sm text-indigo-600 border border-indigo-600 rounded-md hover:bg-indigo-50">
                                    <i class="fas fa-search mr-1"></i>
                                    <span>加入</span>
                                </button>
                            </div>
                        </div>
                        <div id="dorms-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Dorms will be added here dynamically -->
                            <p id="no-dorms-message" class="text-gray-500">你还没有加入任何宿舍，点击"创建"或"加入"按钮开始使用。</p>
                        </div>
                    </div>
                </div>

                <!-- Dorm Management View (hidden by default) -->
                <div id="dorm-management-view" class="hidden">
                    <div class="bg-white rounded-lg shadow p-6">
                        <!-- 在宿舍管理视图的顶部按钮区域添加设置昵称按钮 -->
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center">
                                <button onclick="showHomeView()" class="mr-3 p-2 rounded-md hover:bg-gray-100">
                                    <i class="fas fa-arrow-left text-gray-600"></i>
                                </button>
                                <h2 id="dorm-name-heading" class="text-2xl font-bold text-gray-800">宿舍名称</h2>
                                <span id="dorm-role-badge" class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="nickname-btn" onclick="showNicknameModal()" class="flex items-center px-3 py-1 text-sm text-indigo-600 border border-indigo-600 rounded-md hover:bg-indigo-50">
                                    <i class="fas fa-user-tag mr-1"></i>
                                    <span>设置昵称</span>
                                </button>
                                <button id="invite-btn" onclick="showInviteModal()" class="flex items-center px-3 py-1 text-sm text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
                                    <i class="fas fa-user-plus mr-1"></i>
                                    <span>邀请</span>
                                </button>
                                <button id="members-btn" onclick="showMembersList()" class="flex items-center px-3 py-1 text-sm text-indigo-600 border border-indigo-600 rounded-md hover:bg-indigo-50">
                                    <i class="fas fa-users mr-1"></i>
                                    <span>成员</span>
                                </button>
                            </div>
                        </div>
                        
                        <div id="dorm-tabs" class="border-b border-gray-200">
                            <div class="flex space-x-8">
                                <button onclick="showDormTab('funds')" class="pb-4 px-1 border-b-2 font-medium text-sm tab-btn active-tab" data-tab="funds">
                                    经费管理
                                </button>
                                <button onclick="showDormTab('requests')" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn" data-tab="requests">
                                    申请审批
                                </button>
                                <!-- 添加公物管理标签页按钮 -->
                                <button onclick="showDormTab('public-items'); showPublicItemsTab();" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn" data-tab="public-items">
                                    公物管理
                                </button>
                                <!-- 添加共享文件夹标签页按钮 -->
                                <button onclick="showDormTab('shared-files'); showSharedFilesTab();" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn" data-tab="shared-files">
                                    共享文件夹
                                </button>
                                <!-- 添加生活记录标签页按钮 -->
                                <button onclick="showDormTab('life-records'); showLifeRecordsTab();" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn" data-tab="life-records">
                                    生活记录
                                </button>
                                <button onclick="showDormTab('scene-reconstruction'); showSceneReconstructionTab();" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn" data-tab="scene-reconstruction">
                                    场景重建
                                </button>
                                <button onclick="showDormTab('settings')" id="settings-tab" class="pb-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 tab-btn hidden" data-tab="settings">
                                    宿舍设置
                                </button>
                            </div>
                        </div>

                        <!-- Funds Tab -->
                        <div id="funds-tab" class="mt-6">
                            <div class="bg-indigo-50 rounded-lg p-6 mb-6">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-800">公共经费</h3>
                                        <p class="text-gray-600">宿舍的公共资金池</p>
                                    </div>
                                    <div>
                                        <p id="current-funds" class="text-3xl font-bold text-indigo-600">¥0.00</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg border p-4 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">经费操作</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button onclick="showContributeModal()" class="flex flex-col items-center p-4 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors">
                                        <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mb-2">
                                            <i class="fas fa-hand-holding-usd text-indigo-600"></i>
                                        </div>
                                        <span class="font-medium text-gray-800">缴纳经费</span>
                                        <span class="text-xs text-gray-500">为公共经费做贡献</span>
                                    </button>
                                    <button onclick="showRequestModal()" class="flex flex-col items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                                        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mb-2">
                                            <i class="fas fa-shopping-cart text-green-600"></i>
                                        </div>
                                        <span class="font-medium text-gray-800">申请使用</span>
                                        <span class="text-xs text-gray-500">申请使用公共经费</span>
                                    </button>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg border p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800">经费历史</h3>
                                    <div class="relative">
                                        <button onclick="toggleFundsHistoryFilter()" class="flex items-center px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">
                                            <span id="funds-filter-text">全部</span>
                                            <i class="fas fa-chevron-down ml-1 text-xs"></i>
                                        </button>
                                        <div id="funds-history-filter" class="absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg py-1 z-10 hidden border">
                                            <a onclick="filterFundsHistory('all')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">全部</a>
                                            <a onclick="filterFundsHistory('contribution')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">缴纳</a>
                                            <a onclick="filterFundsHistory('request')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">使用申请</a>
                                        </div>
                                    </div>
                                </div>
                                <ul id="funds-history-list" class="divide-y divide-gray-200">
                                    <!-- Funds history items will be added here dynamically -->
                                    <li class="py-4">
                                        <p class="text-gray-500 text-center">暂无经费记录</p>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Requests Tab -->
                        <div id="requests-tab" class="mt-6 hidden">
                            <div class="bg-white rounded-lg border p-4 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">待审批申请</h3>
                                <div id="pending-requests-list">
                                    <!-- Pending requests will be added here dynamically -->
                                    <p class="text-gray-500 text-center py-8">当前没有待审批的申请</p>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg border p-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-800">申请历史</h3>
                                    <div class="flex items-center">
                                        <div class="relative">
                                            <button onclick="toggleRequestsHistoryFilter()" class="flex items-center px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">
                                                <span id="requests-filter-text">全部</span>
                                                <i class="fas fa-chevron-down ml-1 text-xs"></i>
                                            </button>
                                            <div id="requests-history-filter" class="absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg py-1 z-10 hidden border">
                                                <a onclick="filterRequestsHistory('all')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">全部</a>
                                                <a onclick="filterRequestsHistory('approved')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">已批准</a>
                                                <a onclick="filterRequestsHistory('rejected')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">已拒绝</a>
                                                <a onclick="filterRequestsHistory('pending')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">待处理</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <ul id="requests-history-list" class="divide-y divide-gray-200">
                                    <!-- Requests history will be added here dynamically -->
                                    <li class="py-4">
                                        <p class="text-gray-500 text-center">暂无申请记录</p>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- 添加公物管理标签页内容 -->
                        <div id="public-items-tab" class="mt-6 hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-medium text-gray-900">公共物品</h3>
                                <button onclick="showAddItemModal()" class="flex items-center px-3 py-1 text-sm text-white bg-indigo-600 rounded-md hover:bg-indigo-700">
                                    <i class="fas fa-plus mr-1"></i>
                                    <span>添加物品</span>
                                </button>
                            </div>
                            <div id="public-items-list" class="space-y-4">
                                <!-- 公物列表将在这里动态生成 -->
                            </div>
                        </div>
                        
                        <!-- 添加共享文件夹标签页内容 -->
                        <div id="shared-files-tab" class="mt-6 hidden">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">共享文件夹</h3>
                                
                                <!-- 面包屑导航 -->
                                <div id="file-breadcrumbs" class="flex items-center text-sm mb-4 overflow-x-auto whitespace-nowrap"></div>
                                
                                <!-- 文件列表容器 -->
                                <div id="shared-files-container" class="mt-4"></div>
                            </div>
                        </div>

                        <!-- 在其他标签页内容后面添加生活记录标签页内容 -->
                        <div id="life-records-tab" class="mt-6 hidden">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-medium text-gray-900">生活记录</h3>
                                <div class="flex space-x-2">
                                    <div class="flex rounded-md shadow-sm" role="group">
                                        <button id="grid-mode-btn" onclick="changeDisplayMode('grid')" class="display-mode-btn bg-indigo-600 text-white px-3 py-1 text-sm font-medium rounded-l-md">
                                            <i class="fas fa-th-large mr-1"></i> 网格
                                        </button>
                                        <button id="wall-mode-btn" onclick="changeDisplayMode('wall')" class="display-mode-btn bg-white text-gray-700 px-3 py-1 text-sm font-medium">
                                            <i class="fas fa-th mr-1"></i> 照片墙
                                        </button>
                                        <button id="timeline-mode-btn" onclick="changeDisplayMode('timeline')" class="display-mode-btn bg-white text-gray-700 px-3 py-1 text-sm font-medium rounded-r-md">
                                            <i class="fas fa-stream mr-1"></i> 时间线
                                        </button>
                                    </div>
                                    <button onclick="showAddRecordModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-sm font-medium">
                                        <i class="fas fa-plus mr-1"></i> 添加记录
                                    </button>
                                    <button onclick="createVideoCollection()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm font-medium">
                                        <i class="fas fa-film mr-1"></i> 创建视频合集
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow p-4">
                                <div class="text-sm text-gray-600 mb-4">
                                    <p>在这里记录宿舍生活的精彩瞬间，上传图片、视频或文字记录，与舍友分享美好回忆。</p>
                                </div>
                                
                                <div id="life-records-list" class="mt-4">
                                    <!-- 生活记录列表将在这里渲染 -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- 添加场景重建标签页内容 -->
                        <div id="scene-reconstruction-tab" class="mt-6 hidden">
                            <div id="scene-reconstruction-container">
                                <!-- 场景重建UI将在这里渲染 -->
                            </div>
                        </div>

                        <!-- Settings Tab -->
                        <div id="settings-tab" class="mt-6 hidden">
                            <div class="bg-white rounded-lg border p-4 mb-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">宿舍信息</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">宿舍名称</label>
                                        <input id="dorm-name-input" type="text" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">宿舍ID</label>
                                        <input id="dorm-id-input" type="text" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 bg-gray-100 focus:outline-none" readonly>
                                    </div>
                                    <div class="flex justify-end">
                                        <button onclick="updateDormInfo()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            保存更改
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile View -->
                <div id="profile-view" class="hidden bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">个人资料</h2>
                        <button onclick="showHomeView()" class="p-2 rounded-md hover:bg-gray-100">
                            <i class="fas fa-arrow-left text-gray-600"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="md:col-span-1">
                            <div class="flex flex-col items-center">
                                <div class="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center mb-4">
                                    <i class="fas fa-user text-gray-400 text-4xl"></i>
                                </div>
                                <h3 id="profile-username" class="text-xl font-semibold text-gray-800">用户名</h3>
                                <p class="text-gray-600">注册用户</p>
                            </div>
                        </div>
                        
                        <div class="md:col-span-2">
                            <div class="bg-white rounded-lg border p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-6">基本信息</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                                        <input id="profile-username-input" type="text" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="用户名">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                                        <input id="profile-email-input" type="email" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="邮箱">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
                                        <input id="profile-password-input" type="password" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="新密码">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">确认密码</label>
                                        <input id="profile-confirm-password-input" type="password" class="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="确认密码">
                                    </div>
                                </div>
                                <div class="mt-6 flex justify-end">
                                    <button onclick="updateProfile()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        保存更改
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 在其他模态框后面添加设置昵称的模态框 -->
    <div id="nicknameModal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center border-b px-6 py-4">
                <h3 class="text-lg font-semibold text-gray-900">设置宿舍昵称</h3>
                <button onclick="toggleNicknameModal()" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="nickname-input">在当前宿舍中的昵称</label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="nickname-input" type="text" placeholder="请输入昵称">
                    <p id="nickname-error" class="text-red-500 text-xs italic hidden">昵称不能为空</p>
                </div>
                <div class="flex items-center justify-end">
                    <button onclick="toggleNicknameModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2">
                        取消
                    </button>
                    <button onclick="updateNickname()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="dormmate.js"></script>
    <script src="publicItems.js"></script>
    <script src="sharedFiles.js"></script>
    <script src="lifeRecords.js"></script>
    <script src="sceneReconstruction.js"></script>
</body>
</html>